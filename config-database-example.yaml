# gh-pitfall-scraper 完整配置示例
# 
# 📖 使用方法:
# 1. 复制此文件为 config.yaml
# 2. 根据您的环境修改配置参数
# 3. 设置您的 GitHub Token
# 4. 选择合适的数据库类型
#
# 🗄️ 数据库支持:
# - SQLite: 轻量级，零配置，适合开发和小型部署
# - PostgreSQL: 企业级数据库，适合生产环境和大规模部署
#
# ⚙️ 配置优先级:
# 1. 命令行参数
# 2. 配置文件
# 3. 环境变量
# 4. 默认值
#
# 🔒 安全提示:
# - 不要在配置文件中硬编码敏感信息
# - 使用环境变量存储密码和Token
# - 设置适当的文件权限 (chmod 600 config.yaml)

# ==========================================
# 🔑 GitHub 配置 (必须设置)
# ==========================================
# 
# 获取 GitHub Token:
# 1. 访问 https://github.com/settings/tokens
# 2. 创建新的 Personal Access Token
# 3. 勾选 'repo' 权限
# 4. 将 Token 粘贴到下面或使用环境变量
#
# 💡 建议使用环境变量:
# export GITHUB_TOKEN="ghp_xxx"
# github_token: ${GITHUB_TOKEN}
github_token: "ghp_xxx"               # GitHub Personal Access Token

# ==========================================
# 🗄️ 数据库配置
# ==========================================
#
# 🏗️ 数据库选择指南:
# SQLite 适用场景:
# - 开发测试环境
# - 个人使用和小团队
# - 数据量 < 10万条记录
# - 单机部署
#
# PostgreSQL 适用场景:
# - 生产环境
# - 多用户并发访问
# - 大数据量 (> 10万条记录)
# - 需要高级功能 (存储过程、触发器等)
#
# ⚙️ 配置建议:
# - 开发环境: 使用 SQLite + WAL 模式
# - 生产环境: 使用 PostgreSQL + 连接池
# - 高并发: 调整连接池参数
# - 大数据: 启用自动清理和分区

database:
  # 数据库类型选择
  type: "sqlite"                      # sqlite | postgresql
  driver: "sqlite3"                   # sqlite3 | postgres
  
  # 📊 SQLite 配置 (轻量级数据库)
  # 
  # 💾 文件存储:
  # - 单文件存储，备份简单
  # - 零配置，无需安装数据库服务
  # - 适合单机部署和小团队使用
  #
  # ⚡ 性能优化建议:
  # - 启用 WAL 模式提高并发读取性能
  # - 设置合适的缓存大小 (内存允许的情况下越大越好)
  # - 使用 NORMAL 同步模式平衡性能和数据安全
  #
  # 🔧 调优参数说明:
  # cache_size: 正数为页数，负数为 KB (-10000 = 10MB)
  # synchronous: OFF(最快) < NORMAL(平衡) < FULL(最安全)
  # temp_store: MEMORY(最快) < FILE(中等) < DEFAULT(系统默认)
  
  sqlite:
    file_path: "./data/gh-pitfall-scraper.db"  # 数据库文件路径
    
    # 🚀 性能优化配置
    enable_wal: true                  # ✅ 推荐: WAL 模式，支持并发读
    enable_foreign_keys: true         # ✅ 推荐: 启用外键约束
    busy_timeout: 30000               # ⏱️ 30秒忙等待超时
    synchronous: "NORMAL"             # 🔄 同步模式: OFF|NORMAL|FULL
    cache_size: -10000                # 💾 缓存大小: 负数=KB, 正数=页数 (10MB)
    temp_store: "memory"              # 🗂️ 临时存储: DEFAULT|FILE|MEMORY
    page_size: 4096                   # 📄 页面大小: 通常为4KB
  
  # 🐘 PostgreSQL 配置 (企业级数据库)
  #
  # 🏢 适用场景:
  # - 生产环境部署
  # - 多用户并发访问
  # - 大数据量处理
  # - 需要高级功能 (存储过程、触发器、视图等)
  #
  # 🔒 安全配置:
  # - 生产环境建议启用 SSL
  # - 使用强密码策略
  # - 限制网络访问
  # - 定期更新密码
  #
  # 💡 最佳实践:
  # - 创建专用数据库用户
  # - 设置合适的连接数限制
  # - 启用查询日志监控
  # - 定期执行数据库维护
  
  # 💡 建议使用环境变量:
  # export DB_PASSWORD="your_secure_password"
  # password: ${DB_PASSWORD}
  
  postgresql:
    host: "localhost"                 # 🖥️ 数据库主机地址
    port: 5432                        # 🔌 数据库端口
    user: "postgres"                  # 👤 数据库用户名 (建议创建专用用户)
    password: "password"              # 🔑 数据库密码 (建议使用环境变量)
    dbname: "gh_pitfall_scraper"      # 📊 数据库名称
    sslmode: "disable"                # 🔒 SSL模式: disable|require|verify-ca|verify-full
  
  # 连接池配置
  connection_pool:
    max_open_conns: 25                # 最大打开连接数
    max_idle_conns: 5                 # 最大空闲连接数
    conn_max_lifetime: "300s"         # 连接最大生命周期
    conn_max_idle_time: "60s"         # 连接最大空闲时间
  
  # 性能优化配置
  performance:
    batch_size: 1000                  # 批处理大小 (插入/更新时的批量大小)
    query_timeout: 30                 # 查询超时时间(秒)
    max_connections: 10               # 最大连接数
    idle_timeout: 300                 # 空闲超时时间(秒)
    enable_prepared_statements: true  # 启用预编译语句 (提高性能)
    enable_query_cache: true          # 启用查询缓存
  
  # 缓存配置
  cache:
    enabled: true                     # 是否启用缓存
    size: 1000                        # 缓存大小(条目数)
    ttl: "3600s"                      # 缓存过期时间
    cleanup_interval: "1800s"         # 缓存清理间隔
    compression: false                # 是否压缩缓存数据
  
  # 数据清理策略
  cleanup:
    enabled: true                     # 是否启用自动清理
    interval: "168h"                  # 清理间隔 (7天)
    max_age: "720h"                   # 数据最大保留时间 (30天)
    vacuum_interval: "168h"           # 数据库优化间隔 (7天)
    
    # 分类数据保留策略
    retention_policy:
      issues: "30d"                   # Issues 数据保留 30天
      repositories: "90d"             # 仓库信息保留 90天
      analytics: "365d"               # 分析数据保留 1年
      logs: "7d"                      # 日志数据保留 7天
  
  # 备份策略
  backup:
    enabled: true                     # 是否启用自动备份
    interval: "12h"                   # 备份间隔 (12小时)
    retention_days: 7                 # 备份保留天数
    path: "./backups"                 # 备份文件路径
    compress: false                   # 是否压缩备份文件
    encryption: false                 # 是否加密备份文件
    backup_type: "full"               # 备份类型: full(全量), incremental(增量)
  
  # 监控和日志
  monitoring:
    enabled: true                     # 是否启用监控
    log_slow_queries: true            # 是否记录慢查询
    slow_query_threshold: 1000        # 慢查询阈值(毫秒)
    log_queries: false                # 是否记录所有查询 (谨慎使用)
    metrics_enabled: true             # 是否启用指标收集
    health_check_interval: "60s"      # 健康检查间隔
  
  # 数据库迁移
  migration:
    auto_migrate: true                # 是否自动运行迁移
    migration_path: "./migrations"    # 迁移文件路径
    backup_before_migrate: true       # 迁移前是否备份

# ==========================================
# 应用配置
# ==========================================
app:
  # 基础配置
  name: "gh-pitfall-scraper"
  version: "2.0.0"
  log_level: "info"                   # 日志级别: debug, info, warn, error
  data_dir: "./data"                  # 数据目录
  output_dir: "./output"              # 输出目录
  
  # 性能配置
  max_workers: 5                      # 最大工作线程数
  worker_queue: 100                   # 工作队列大小
  request_interval: 1000              # API请求间隔(毫秒)
  timeout: 30                         # 请求超时时间(秒)

# ==========================================
# 爬虫配置
# ==========================================
scraping:
  # 并发控制
  concurrency:
    max_workers: 5                    # 最大工作线程数
    requests_per_second: 10           # 每秒最大请求数
    retry_attempts: 3                 # 请求重试次数
    retry_delay: 1                    # 重试延迟(秒)
    timeout: 30                       # 请求超时(秒)
  
  # 数据过滤
  filtering:
    min_score: 10.0                   # 最小评分阈值
    min_reactions: 5                  # 最少反应数
    min_comments: 2                   # 最少评论数
    date_range_days: 90               # 日期范围(天)
    include_closed: false             # 是否包含已关闭的问题
    min_stars: 0                      # 仓库最小Star数
  
  # 去重配置
  deduplication:
    enabled: true                     # 是否启用去重
    similarity_threshold: 0.85        # 相似度阈值 (0.0-1.0)
    content_hash: true                # 是否使用内容哈希去重
    title_similarity: true            # 是否使用标题相似度检测
    fuzzy_matching: true              # 是否使用模糊匹配

# ==========================================
# 仓库配置
# ==========================================
repos:
  - owner: vllm-project
    name: vllm
    enabled: true                     # 是否启用
    priority: "High"                  # 优先级: High, Medium, Low
  - owner: sgl-project
    name: sglang
    enabled: true
    priority: "High"
  - owner: NVIDIA
    name: TensorRT-LLM
    enabled: true
    priority: "High"
  - owner: microsoft
    name: DeepSpeed
    enabled: true
    priority: "High"
  - owner: pytorch
    name: pytorch
    enabled: true
    priority: "Medium"
  - owner: huggingface
    name: transformers
    enabled: true
    priority: "Medium"

# ==========================================
# 关键词配置
# ==========================================
keywords:
  # 高优先级关键词
  high_priority:
    - "performance regression"
    - "memory leak"
    - "CUDA out of memory"
    - "NCCL timeout"
    - "distributed training failure"
    - "inference bottleneck"
    - "kv cache issue"
    - "flash attention bug"
    - "model serving crash"
  
  # 中等优先级关键词
  medium_priority:
    - "performance"
    - "regression"
    - "latency"
    - "throughput"
    - "OOM"
    - "hang"
    - "deadlock"
    - "crash"
    - "freeze"
    - "timeout"
  
  # 技术栈关键词
  tech_stack:
    - "CUDA"
    - "kernel"
    - "NCCL"
    - "PyTorch"
    - "TensorFlow"
    - "JAX"
    - "vLLM"
    - "transformers"
    - "DeepSpeed"
    - "Ray"

# ==========================================
# 分类配置
# ==========================================
classification:
  # 自动分类
  auto_categorize: true               # 是否启用自动分类
  confidence_threshold: 0.7           # 置信度阈值 (0.0-1.0)
  learning_mode: false                # 是否启用学习模式
  
  # 分类规则
  rules:
    - name: "Performance Issues"
      pattern: "performance|slow|latency|throughput|bottleneck"
      category: "Performance"
      priority: "High"
      weight: 1.5
      enabled: true
    
    - name: "Memory Issues"
      pattern: "memory|oom|memory leak|out of memory"
      category: "Memory"
      priority: "Critical"
      weight: 2.0
      enabled: true
    
    - name: "CUDA/GPU Issues"
      pattern: "cuda|gpu|nvidia|cuda kernel|cuda error"
      category: "GPU"
      priority: "High"
      weight: 1.8
      enabled: true
    
    - name: "Distributed Training"
      pattern: "distributed|nccl|multi-node|cluster"
      category: "Distributed"
      priority: "High"
      weight: 1.6
      enabled: true
    
    - name: "Inference Issues"
      pattern: "inference|serving|kv cache|prefill|decode"
      category: "Inference"
      priority: "Medium"
      weight: 1.2
      enabled: true

# ==========================================
# 输出配置
# ==========================================
output:
  # 文件输出
  files:
    enabled: true                     # 是否启用文件输出
    format: "json"                    # 输出格式: json, csv, markdown
    path: "./output"                  # 输出目录
    prefix: "issues"                  # 文件前缀
    compress: false                   # 是否压缩输出文件
  
  # 数据库输出
  database:
    enabled: true                     # 是否启用数据库存储
    save_raw_data: true               # 是否保存原始数据
    save_analytics: true              # 是否保存分析数据
    save_time_series: true            # 是否保存时间序列数据
    batch_insert: true                # 是否使用批量插入
  
  # 报告生成
  reports:
    enabled: true                     # 是否启用报告生成
    formats: ["markdown", "html"]     # 报告格式列表
    include_charts: true              # 是否包含图表
    include_stats: true               # 是否包含统计信息
    template_path: "./templates"      # 模板路径

# ==========================================
# 日志配置
# ==========================================
logging:
  level: "info"                       # 日志级别: debug, info, warn, error
  format: "text"                      # 日志格式: text, json
  output: "stdout"                    # 输出目标: stdout, file, both
  file_path: "./logs/app.log"         # 日志文件路径
  max_size: 100                       # 最大文件大小(MB)
  max_age: 30                         # 最大保留天数
  max_backups: 5                      # 最大备份文件数
  compress: true                      # 是否压缩旧日志文件
  
  # 数据库操作日志
  database:
    enabled: true
    log_slow_queries: true            # 是否记录慢查询
    slow_query_threshold: 1000        # 慢查询阈值(毫秒)
    log_level: "warn"                 # 数据库日志级别

# ==========================================
# 开发配置
# ==========================================
development:
  # 调试模式
  debug: false                        # 是否启用调试模式
  profiling: false                    # 是否启用性能分析
  
  # 测试配置
  testing:
    mock_github_api: false            # 是否模拟 GitHub API
    test_data_path: "./testdata"      # 测试数据路径
    seed_data: false                  # 是否加载种子数据
  
  # 开发工具
  tools:
    hot_reload: false                 # 是否启用热重载
    auto_restart: false               # 是否启用自动重启
    api_docs: false                   # 是否启用 API 文档
    debug_endpoint: "/debug"          # 调试端点路径

# ==========================================
# 监控配置 (可选)
# ==========================================
monitoring:
  # 健康检查
  health_check:
    enabled: false                    # 是否启用健康检查
    interval: 60                      # 检查间隔(秒)
    timeout: 30                       # 超时时间(秒)
  
  # 性能监控
  performance:
    enabled: false
    collect_metrics: true
    metrics_endpoint: "/metrics"
    metrics_interval: 30
  
  # 告警配置
  alerts:
    enabled: false
    email_notifications: false
    webhook_url: ""                   # Webhook URL
    slack_webhook: ""                 # Slack Webhook
    alert_cooldown: 300               # 告警冷却时间(秒)